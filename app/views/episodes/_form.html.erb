<%= form_with model: [@podcast, @episode], multipart: true, class: "space-y-6" do |form| %>
  <!-- Basic Information Section -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-900 mb-4">Episode Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="col-span-2 md:col-span-1">
        <%= form.label :name, "Episode Title", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :name, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500", placeholder: "Enter episode title" %>
        <% if @episode.errors[:name].any? %>
          <p class="mt-1 text-sm text-red-600"><%= @episode.errors[:name].join(", ") %></p>
        <% end %>
      </div>

      <div>
        <%= form.label :number, "Episode Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.number_field :number, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500", placeholder: "1" %>
        <% if @episode.errors[:number].any? %>
          <p class="mt-1 text-sm text-red-600"><%= @episode.errors[:number].join(", ") %></p>
        <% end %>
      </div>
    </div>

    <div class="mt-6">
      <%= form.label :description, "Episode Description", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_area :description, rows: 4, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500", placeholder: "Describe what this episode is about..." %>
      <% if @episode.errors[:description].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @episode.errors[:description].join(", ") %></p>
      <% end %>
    </div>
  </div>

  <!-- Episode Details Section -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-900 mb-4">Episode Details</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <%= form.label :release_date, "Release Date", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.date_field :release_date, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        <% if @episode.errors[:release_date].any? %>
          <p class="mt-1 text-sm text-red-600"><%= @episode.errors[:release_date].join(", ") %></p>
        <% end %>
      </div>

      <div>
        <%= form.label :format, "Episode Format", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.select :format,
            options_for_select(Episode::FORMAT_OPTIONS.map { |o| [o, o] }, @episode.format),
            { prompt: 'Select format' },
            { class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" } %>
      </div>
    </div>

    <div class="mt-6">
      <%= form.label :links, "Links or Guest Names", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :links, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500", placeholder: "e.g., Guest names, website links, social media handles..." %>
      <% if @episode.errors[:links].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @episode.errors[:links].join(", ") %></p>
      <% end %>
    </div>

    <div class="mt-6">
      <%= form.label :notes, "Production Notes", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_area :notes, rows: 3, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500", placeholder: "Any additional notes for the production team..." %>
    </div>
  </div>

  <!-- Cover Art Section -->
  <div class="mb-8">
    <%
      # Show podcast cover art as fallback hint if no episode cover
      fallback_hint = if !@episode.cover_art.attached? && @podcast.cover_art.attached?
        "No episode cover uploaded. The podcast cover will be used as fallback."
      else
        "PNG, JPG, or WEBP. Max 5MB."
      end
    %>
    <%= render "shared/file_upload",
          form: form,
          attachment_name: :cover_art,
          multiple: false,
          accept: "image/png,image/jpeg,image/webp",
          max_size_mb: 5,
          existing_files: @episode.cover_art.attached? ? [@episode.cover_art] : [],
          label_param: "cover_art_labels",
          section_label: "Cover Art",
          instructions: "Drag and drop your cover image here, or",
          hint: fallback_hint %>
    <%= hidden_field_tag "episode[remove_cover_art]", "0", id: "episode_remove_cover_art" %>
    <% if @episode.errors[:cover_art].any? %>
      <p class="mt-2 text-sm text-red-600"><%= @episode.errors[:cover_art].first %></p>
    <% end %>
  </div>

  <!-- Raw Audio Section -->
  <div class="mb-8">
    <%= render "shared/file_upload",
          form: form,
          attachment_name: :raw_audio,
          multiple: false,
          accept: "audio/*,audio/wav,audio/wave,audio/x-wav,.wav,.mp3,.m4a,.aac,.ogg,.flac",
          max_size_mb: 500,
          existing_files: @episode.raw_audio.attached? ? [@episode.raw_audio] : [],
          label_param: "raw_audio_labels",
          section_label: "Raw Audio",
          instructions: "Drag and drop your raw audio file here, or",
          hint: "MP3, WAV, M4A, or other audio formats. Max 500MB." %>
    <%= hidden_field_tag "episode[remove_raw_audio]", "0", id: "episode_remove_raw_audio" %>
  </div>

  <!-- Additional Assets Section -->
  <div class="mb-8">
    <% delete_url = @episode.persisted? ? podcast_episode_wizard_upload_asset_path(@podcast, @episode, "assets", attachment_id: ":id") : nil %>
    <%= render "shared/file_upload",
          form: form,
          attachment_name: :assets,
          multiple: true,
          accept: "audio/*,video/*,audio/wav,audio/wave,audio/x-wav,.wav,.mp3,.m4a,.aac,.ogg,.flac,.mp4,.mov,.avi,.mkv,.webm",
          max_size_mb: 500,
          existing_files: @episode.assets.attachments,
          delete_url: delete_url,
          label_param: "asset_labels",
          section_label: "Additional Assets",
          instructions: "Drag and drop additional files here, or",
          hint: "Upload show notes, transcripts, images, or other supporting files." %>
  </div>

  <!-- Form Actions -->
  <div class="flex space-x-4 pt-6 border-t border-gray-200">
    <% if @episode.persisted? %>
      <%= link_to podcast_episode_path(@podcast, @episode), class: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-3 px-4 rounded-lg text-center transition-colors duration-200" do %>
        Cancel
      <% end %>
      <%= form.submit "Update Episode", class: "flex-1 bg-orange-600 hover:bg-orange-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors duration-200 cursor-pointer" %>
    <% else %>
      <%= link_to podcast_episodes_path(@podcast), class: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-3 px-4 rounded-lg text-center transition-colors duration-200" do %>
        Cancel
      <% end %>
      <%= form.submit "Create Episode", class: "flex-1 bg-orange-600 hover:bg-orange-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors duration-200 cursor-pointer" %>
    <% end %>
  </div>
<% end %>
