<%= render 'form', locals: { step: step, steps: @steps } do |f| %>
  <%= render "podcast_steps/progress_bar", wizard_steps: @steps %>
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-6 space-y-6">
    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <h3 class="text-sm font-medium text-blue-800">Review and Finalize Your Episode</h3>
      <p class="mt-1 text-sm text-blue-600">Review all episode information below and make any final changes before finishing.</p>
    </div>

    <!-- Basic Information -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium text-gray-900">Basic Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :name, "Episode Title", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :name, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
        <div>
          <%= f.label :number, "Episode Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :number, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
      </div>
      <div>
        <%= f.label :description, "Episode Description", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :description, rows: 4, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
      </div>
    </div>

    <!-- Details -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium text-gray-900">Details</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :release_date, "Release Date", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.date_field :release_date, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
        <div>
          <%= f.label :format, "Episode Format", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :format,
              options_for_select(Episode::FORMAT_OPTIONS.map { |o| [o, o] }, @episode.format),
              { prompt: 'Select format' },
              { class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" } %>
        </div>
      </div>
      <div>
        <%= f.label :links, "Links or Guest Names", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :links, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
      </div>
      <div>
        <%= f.label :notes, "Production Notes", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :notes, rows: 3, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
      </div>
    </div>

    <!-- Assets -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium text-gray-900">Assets</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :cover_art, "Cover Art", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <% if @episode.cover_art.attached? %>
            <div class="flex items-center space-x-3 mb-2">
              <%= image_tag @episode.cover_art, class: "h-16 w-16 object-cover rounded-lg" %>
              <div>
                <p class="text-sm text-gray-900"><%= @episode.cover_art.filename %></p>
                <p class="text-xs text-gray-500">Current cover art</p>
              </div>
            </div>
          <% elsif @podcast.cover_art.attached? %>
            <div class="flex items-center space-x-3 mb-2">
              <%= image_tag @podcast.cover_art, class: "h-16 w-16 object-cover rounded-lg" %>
              <div>
                <p class="text-sm text-gray-900">Using podcast cover art</p>
                <p class="text-xs text-gray-500">No episode cover uploaded. The podcast cover will be used.</p>
              </div>
            </div>
          <% end %>
          <%= f.file_field :cover_art, class: "w-full mt-2 text-sm text-gray-500 file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-600 file:text-white hover:file:bg-orange-700" %>
        </div>
        <div>
          <%= f.label :raw_audio, "Raw Audio", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <% if @episode.raw_audio.attached? %>
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm text-gray-900"><%= @episode.raw_audio.filename %></span>
              <%= link_to "Download", rails_blob_path(@episode.raw_audio, disposition: "attachment"), class: "text-orange-600 hover:text-orange-700 text-sm font-medium" %>
            </div>
          <% end %>
          <%= f.file_field :raw_audio, accept: "audio/*", class: "w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-600 file:text-white hover:file:bg-orange-700" %>
        </div>
      </div>
      <div>
        <%= f.label :assets, "Additional Assets", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <% if @episode.assets.any? %>
          <div class="space-y-2 max-h-48 overflow-y-auto mb-2">
            <% @episode.assets.each do |asset| %>
              <div class="flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <span class="text-sm font-medium text-gray-900"><%= asset.filename %></span>
                <%= link_to "Download", rails_blob_path(asset, disposition: "attachment"), class: "text-orange-600 hover:text-orange-700 text-sm font-medium" %>
              </div>
            <% end %>
          </div>
        <% end %>
        <%= f.file_field :assets, multiple: true, class: "w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-600 file:text-white hover:file:bg-orange-700" %>
      </div>
    </div>
  </div>
  <%= render "episode_steps/pagination", f: f, step: step %>
<% end %>


