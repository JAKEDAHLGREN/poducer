<%= render 'form', locals: { step: step, steps: @steps } do |f| %>
  <%= render "podcast_steps/progress_bar", wizard_steps: @steps %>
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-6 space-y-6">
    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
      <h3 class="text-sm font-medium text-green-800">Review and Finalize Your Episode</h3>
      <p class="mt-1 text-sm text-green-600">Review all episode information below and make any final changes before finishing.</p>
    </div>

    <!-- Basic Information -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium text-gray-900">Basic Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :name, "Episode Title", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :name, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
        <div>
          <%= f.label :number, "Episode Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :number, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
      </div>
      <div>
        <%= f.label :description, "Episode Description", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :description, rows: 4, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
      </div>
    </div>

    <!-- Details -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium text-gray-900">Details</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :release_date, "Release Date", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.date_field :release_date, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
        <div>
          <%= f.label :format, "Episode Format", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :format,
              options_for_select(Episode::FORMAT_OPTIONS.map { |o| [o, o] }, @episode.format),
              { prompt: 'Select format' },
              { class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" } %>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= f.label :guests, "Guests (comma-separated)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :guests, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
        <div>
          <%= f.label :links, "Links (comma-separated)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :links, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Final Output Formats</label>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <label class="inline-flex items-center gap-2">
            <%= f.check_box :deliver_mp3, { class: "h-4 w-4 rounded border-gray-300 text-orange-600 focus:ring-orange-500" }, true, false %>
            <span class="text-sm text-gray-800">MP3</span>
          </label>
          <label class="inline-flex items-center gap-2">
            <%= f.check_box :deliver_mp4, { class: "h-4 w-4 rounded border-gray-300 text-orange-600 focus:ring-orange-500" }, true, false %>
            <span class="text-sm text-gray-800">MP4</span>
          </label>
          <label class="inline-flex items-center gap-2">
            <%= f.check_box :deliver_mov, { class: "h-4 w-4 rounded border-gray-300 text-orange-600 focus:ring-orange-500" }, true, false %>
            <span class="text-sm text-gray-800">MOV</span>
          </label>
        </div>
      </div>
      <div>
        <%= f.label :notes, "Production Notes", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :notes, rows: 3, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" %>
      </div>
    </div>

    <!-- Assets -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium text-gray-900">Assets</h3>
      <div class="grid grid-cols-1 gap-6">
        <div class="col-span-1">
          <!-- Cover Art -->
          <%= render "shared/file_upload",
                form: f,
                attachment_name: :cover_art,
                multiple: false,
                accept: "image/png,image/jpeg,image/webp",
                existing_files: @episode.cover_art.attached? ? [@episode.cover_art] : [],
                label_param: "cover_art_labels",
                section_label: "Cover Art",
                instructions: "Drag and drop your cover image here, or",
                hint: "PNG, JPG, or WEBP. If no episode cover art is selected, we will default to the podcast cover art." %>
          <%= hidden_field_tag "episode[remove_cover_art]", "0", id: "episode_remove_cover_art_summary" %>

        </div>

        <div class="col-span-1">
          <!-- Assets -->
          <%= render "shared/file_upload",
                form: f,
                attachment_name: :assets,
                multiple: true,
                accept: "audio/*,video/*",
                existing_files: @episode.assets.attachments,
                delete_url: wizard_destroy_asset_path(podcast_id: @podcast.id, episode_id: @episode.id, attachment_id: ":id"),
                label_param: "asset_labels",
                section_label: "Upload Audio/Video",
                instructions: "Drag and drop audio/video files here, or",
                hint: "You can select multiple files." %>
        </div>
      </div>
    </div>
  </div>
  <%= render "episode_steps/pagination", f: f, step: step %>
<% end %>
